<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æœºé•¿èµ·é£æ—¥è®° âœˆï¸</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f9ff;
      --card: #ffffff;
      --primary: #4a90e2;
      --success: #50c878;
      --text: #2c3e50;
      --text-light: #7f8c8d;
      --shadow: 0 8px 32px rgba(74,144,226,0.12);
      --radius: 24px;
    }
    body {
      font-family: 'Poppins', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--bg), #e6f0ff);
      color: var(--text);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container { max-width: 420px; margin: 0 auto; padding: 24px 16px; flex: 1; }
    .page { display: none; }
    .page.active { display: block; }
    .header { text-align: center; margin: 32px 0 40px; }
    .greeting { font-size: 2.2rem; font-weight: 700; background: linear-gradient(90deg, var(--primary), #6ab0f3); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .status-card { background: var(--card); border-radius: var(--radius); padding: 28px 20px; box-shadow: var(--shadow); margin-bottom: 32px; }
    .today { font-size: 1.4rem; font-weight: 600; margin: 16px 0 24px; text-align: center; }
    .streak-box { display: flex; gap: 16px; margin: 24px 0; }
    .streak-item { flex: 1; background: rgba(74,144,226,0.05); border-radius: 16px; padding: 16px; text-align: center; }
    .streak-num { font-size: 2.5rem; font-weight: 700; color: var(--primary); }
    .streak-label { font-size: 0.9rem; color: var(--text-light); }
    .mood-section { margin-top: 32px; text-align: center; }
    .mood-title { font-size: 1.1rem; margin-bottom: 12px; color: var(--text-light); }
    .mood-options { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
    .mood-btn { font-size: 2.2rem; background: none; border: 2px solid transparent; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; transition: all 0.2s; }
    .mood-btn:hover, .mood-btn.selected { border-color: var(--primary); transform: scale(1.15); background: rgba(74,144,226,0.1); }
    .fly-btn { background: linear-gradient(135deg, var(--primary), #5fa8f5); color: white; font-size: 1.3rem; font-weight: 600; border: none; border-radius: 999px; padding: 18px; width: 100%; margin: 40px 0; box-shadow: 0 12px 32px rgba(74,144,226,0.3); cursor: pointer; transition: all 0.3s; }
    .fly-btn:hover { transform: translateY(-3px); }
    .fly-btn:disabled { background: linear-gradient(135deg, var(--success), #6ade9b); }
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.95); border-top: 1px solid rgba(74,144,226,0.1); display: flex; padding: 12px 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.05); }
    .nav-item { flex: 1; text-align: center; font-size: 1.8rem; color: var(--text-light); cursor: pointer; transition: all 0.3s; }
    .nav-item.active { color: var(--primary); transform: scale(1.15); }
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 32px 0; }
    .stats-card { background: var(--card); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); text-align: center; }
    .recent-moods { margin-top: 32px; padding: 20px; background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); }
    .moods-title { font-size: 1.1rem; margin-bottom: 16px; text-align: center; }
    .mood-history { display: flex; justify-content: space-around; gap: 12px; flex-wrap: wrap; }
    .mood-day { text-align: center; font-size: 0.9rem; color: var(--text-light); }
    .mood-emoji { font-size: 1.8rem; }
    .clear-btn { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; border: none; border-radius: 16px; padding: 16px; font-size: 1.1rem; width: 100%; margin-top: 32px; cursor: pointer; }
  </style>
</head>
<body>

<div class="container">
  <div id="home" class="page active">
    <div class="header"><div class="greeting">æœºé•¿ï¼Œä¸­åˆå¥½ï¼ âœˆï¸</div></div>
    <div class="status-card">
      <div class="today" id="todayStatus">ä»Šæ—¥è¿˜æ²¡èµ·é£</div>
      <div class="streak-box">
        <div class="streak-item"><div class="streak-num" id="currentStreak">0</div><div class="streak-label">å½“å‰è¿é£</div></div>
        <div class="streak-item"><div class="streak-num" id="maxStreak">0</div><div class="streak-label">å†å²æœ€é•¿</div></div>
      </div>
      <div class="mood-section" id="moodSection">
        <div class="mood-title">ä»Šå¤©çš„å¿ƒæƒ…æ˜¯ï¼Ÿ</div>
        <div class="mood-options">
          <button class="mood-btn" data-mood="super">ğŸ˜</button>
          <button class="mood-btn" data-mood="happy">ğŸ˜Š</button>
          <button class="mood-btn" data-mood="normal">ğŸ˜</button>
          <button class="mood-btn" data-mood="tired">ğŸ˜´</button>
          <button class="mood-btn" data-mood="sad">ğŸ˜”</button>
        </div>
      </div>
    </div>
    <button class="fly-btn" id="flyBtn">âœˆï¸ èµ·é£ï¼</button>
  </div>

  <div id="stats" class="page">
    <div class="header"><div class="greeting">é£è¡Œç»Ÿè®¡ ğŸ“Š</div></div>
    <div class="stats-grid">
      <div class="stats-card"><div class="label">æœ¬å‘¨</div><div class="value" id="statsWeek">0 æ¬¡</div></div>
      <div class="stats-card"><div class="label">æœ¬æœˆ</div><div class="value" id="statsMonth">0 æ¬¡</div></div>
      <div class="stats-card"><div class="label">ä»Šå¹´</div><div class="value" id="statsYear">0 æ¬¡</div></div>
      <div class="stats-card"><div class="label">æ€»è®¡</div><div class="value" id="statsTotal">0 æ¬¡</div></div>
    </div>
    <div class="recent-moods">
      <div class="moods-title">æœ€è¿‘7å¤©å¿ƒæƒ…</div>
      <div class="mood-history" id="moodHistory"></div>
    </div>
  </div>

  <div id="settings" class="page">
    <div class="header"><div class="greeting">è®¾ç½® âš™ï¸</div></div>
    <div class="status-card">
      <p style="margin:24px 0; font-size:1.1rem;">åŠŸèƒ½è¯´æ˜</p>
      <ul style="padding-left:24px; line-height:2; color:var(--text-light);">
        <li>æ¯æ—¥ä¸€æ¬¡èµ·é£ + å¿ƒæƒ…</li>
        <li>è¿ç»­ & æœ€é•¿è®°å½•</li>
        <li>æœ¬åœ°ä¿å­˜</li>
      </ul>
      <button class="clear-btn" id="clearBtn">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
    </div>
  </div>
</div>

<div class="bottom-nav">
  <div class="nav-item active" data-page="home">ğŸ </div>
  <div class="nav-item" data-page="stats">ğŸ“Š</div>
  <div class="nav-item" data-page="settings">âš™ï¸</div>
</div>

<script>
console.log("è„šæœ¬å¼€å§‹æ‰§è¡Œ - å¦‚æœä½ çœ‹åˆ°è¿™æ¡ï¼ŒJS å°±è¿è¡Œäº†ï¼");

const MOODS = { super: 'ğŸ˜', happy: 'ğŸ˜Š', normal: 'ğŸ˜', tired: 'ğŸ˜´', sad: 'ğŸ˜”' };

const pages = document.querySelectorAll('.page');
const navItems = document.querySelectorAll('.nav-item');

function switchPage(pageId) {
  pages.forEach(p => p.classList.remove('active'));
  navItems.forEach(n => n.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
  if (pageId === 'stats') loadStats();
}

navItems.forEach(item => {
  item.addEventListener('click', () => {
    console.log("å¯¼èˆªç‚¹å‡»:", item.dataset.page);
    switchPage(item.dataset.page);
  });
});

function getTodayKey() {
  const d = new Date();
  d.setMinutes(d.getMinutes() - d.getTimezoneOffset() + 480);
  return 'fly_' + d.toISOString().split('T')[0];
}

function getMoodKey(date = getTodayKey().replace('fly_', '')) {
  return 'mood_' + date;
}

function loadHome() {
  console.log("åŠ è½½ä¸»é¡µæ•°æ®");
  const flew = localStorage.getItem(getTodayKey()) === '1';
  document.getElementById('todayStatus').textContent = flew ? 'ä»Šæ—¥å·²èµ·é£ï¼ğŸš€' : 'ä»Šæ—¥è¿˜æ²¡èµ·é£';
  document.getElementById('flyBtn').disabled = flew;
  document.getElementById('flyBtn').textContent = flew ? 'ä»Šæ—¥å·²èµ·é£ âœ“' : 'âœˆï¸ èµ·é£ï¼';

  let streak = 0;
  let date = new Date();
  date.setMinutes(date.getMinutes() - date.getTimezoneOffset() + 480);
  while (localStorage.getItem('fly_' + date.toISOString().split('T')[0]) === '1') {
    streak++;
    date.setDate(date.getDate() - 1);
  }
  document.getElementById('currentStreak').textContent = streak;
  document.getElementById('maxStreak').textContent = Math.max(streak, parseInt(localStorage.getItem('max_streak') || '0'));

  document.getElementById('moodSection').style.display = flew ? 'none' : 'block';
}

let selectedMood = null;
document.querySelectorAll('.mood-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedMood = btn.dataset.mood;
    console.log("é€‰ä¸­å¿ƒæƒ…:", selectedMood);
  });
});

document.getElementById('flyBtn').addEventListener('click', () => {
  if (document.getElementById('flyBtn').disabled) return;
  console.log("èµ·é£æŒ‰é’®ç‚¹å‡»");
  localStorage.setItem(getTodayKey(), '1');
  if (selectedMood) localStorage.setItem(getMoodKey(), selectedMood);

  let current = parseInt(document.getElementById('currentStreak').textContent);
  let max = parseInt(localStorage.getItem('max_streak') || '0');
  if (current > max) localStorage.setItem('max_streak', current);

  loadHome();
  selectedMood = null;
});

function loadStats() {
  console.log("åŠ è½½ç»Ÿè®¡é¡µ");
  let week = 0, month = 0, year = 0, total = 0;
  const now = new Date();
  now.setMinutes(now.getMinutes() - now.getTimezoneOffset() + 480);
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('fly_') && localStorage.getItem(key) === '1') {
      total++;
      const dStr = key.replace('fly_', '');
      const d = new Date(dStr);
      if (d >= new Date(now.getFullYear(), now.getMonth(), now.getDate() - 6)) week++;
      if (d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth()) month++;
      if (d.getFullYear() === now.getFullYear()) year++;
    }
  }
  document.getElementById('stats