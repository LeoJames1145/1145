<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æœºé•¿èµ·é£æ—¥è®° âœˆï¸</title>
  <style>
    /* ä¿æŒå’Œä¹‹å‰å‡ ä¹ä¸€æ ·çš„æ ·å¼ï¼Œçœç•¥ä»¥èŠ‚çœç©ºé—´ */
    body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #f0f4ff, #e6f0ff); color:#333; margin:0; min-height:100vh; display:flex; flex-direction:column; }
    .container { max-width:420px; margin:0 auto; padding:16px; flex:1; }
    .page { display:none; }
    .page.active { display:block; }
    .header { text-align:center; margin:20px 0 30px; }
    .greeting { font-size:28px; font-weight:700; color:#1a73e8; }
    .status-card { background:white; border-radius:16px; padding:20px; box-shadow:0 4px 20px rgba(0,0,0,0.08); margin-bottom:24px; text-align:center; }
    .today { font-size:20px; font-weight:600; margin:12px 0 20px; }
    .this-week { display:flex; gap:16px; justify-content:center; margin:24px 0; }
    .week-item { background:#f8fbff; border-radius:12px; padding:16px 24px; flex:1; text-align:center; }
    .label { font-size:14px; color:#777; margin-bottom:6px; }
    .value { font-size:32px; font-weight:bold; color:#1a73e8; }
    .fly-btn { background:linear-gradient(90deg,#1a73e8,#4285f4); color:white; font-size:20px; font-weight:bold; border:none; border-radius:999px; padding:16px 0; width:100%; margin:32px 0 40px; box-shadow:0 6px 20px rgba(26,115,232,0.3); cursor:pointer; }
    .fly-btn:disabled { background:linear-gradient(90deg,#34a853,#4caf50); }
    .bottom-nav { position:fixed; bottom:0; left:0; right:0; background:white; border-top:1px solid #eee; display:flex; padding:10px 0; box-shadow:0 -2px 10px rgba(0,0,0,0.05); }
    .nav-item { flex:1; text-align:center; font-size:24px; color:#888; cursor:pointer; }
    .nav-item.active { color:#1a73e8; }
  </style>
</head>
<body>

<div class="container">

  <div id="home" class="page active">
    <div class="header">
      <div class="greeting">ä¸­åˆå¥½ï¼æœºé•¿ âœˆï¸</div>
    </div>
    <div class="status-card">
      <div class="today" id="todayStatus">ä»Šæ—¥è¿˜æ²¡èµ·é£</div>
      <div class="this-week">
        <div class="week-item">
          <div class="label">æ¬¡æ•°</div>
          <div class="value" id="weekCount">â€”</div>
        </div>
        <div class="week-item">
          <div class="label">çŠ¶æ€</div>
          <div class="value" id="weekStatus">å¾…æœº</div>
        </div>
      </div>
    </div>
    <button class="fly-btn" id="flyBtn">âœˆï¸ èµ·é£ï¼</button>
  </div>

  <div id="stats" class="page">
    <div class="header"><div class="greeting">èµ·é£ç»Ÿè®¡ ğŸ“Š</div></div>
    <div class="status-card">
      <p id="statsContent">åŠ è½½ä¸­...</p>
    </div>
  </div>

  <div id="settings" class="page">
    <div class="header"><div class="greeting">è®¾ç½® âš™ï¸</div></div>
    <div class="status-card">
      <button style="background:#ea4335;color:white;border:none;border-radius:12px;padding:14px;font-size:16px;width:100%;cursor:pointer;" id="clearBtn">æ¸…ç©ºæˆ‘çš„æ‰€æœ‰è®°å½•</button>
    </div>
  </div>

</div>

<div class="bottom-nav">
  <div class="nav-item active" data-page="home">ğŸ </div>
  <div class="nav-item" data-page="stats">ğŸ“Š</div>
  <div class="nav-item" data-page="settings">âš™ï¸</div>
</div>

<script>
const API_BASE = "https://leojames1145.github.io/1145/";  // â† æ”¹æˆä½ çœŸå®çš„æœåŠ¡å™¨åœ°å€

const pages = document.querySelectorAll('.page');
const navItems = document.querySelectorAll('.nav-item');

function switchPage(pageId) {
  pages.forEach(p => p.classList.remove('active'));
  navItems.forEach(n => n.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
  if (pageId === 'stats') loadStats();
}

navItems.forEach(item => item.addEventListener('click', () => switchPage(item.dataset.page)));

const flyBtn = document.getElementById('flyBtn');

async function apiRequest(endpoint, method = 'GET', body = null) {
  try {
    const res = await fetch(`\( {API_BASE} \){endpoint}`, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: body ? JSON.stringify(body) : null,
      credentials: 'include'   // å¦‚æœä½ ç”¨ cookie/session é‰´æƒ
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return await res.json();
  } catch (err) {
    console.error(err);
    alert("ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ");
    return null;
  }
}

async function loadTodayAndWeek() {
  const data = await apiRequest('/status');
  if (!data) return;

  const { today_flew, week_count, week_status } = data;
  document.getElementById('todayStatus').textContent = today_flew ? 'ä»Šæ—¥å·²èµ·é£ï¼ğŸš€' : 'ä»Šæ—¥è¿˜æ²¡èµ·é£';
  document.getElementById('weekCount').textContent = week_count;
  document.getElementById('weekStatus').textContent = week_status;

  flyBtn.disabled = today_flew;
  flyBtn.textContent = today_flew ? 'ä»Šæ—¥å·²èµ·é£ âœ“' : 'âœˆï¸ èµ·é£ï¼';
}

async function fly() {
  const res = await apiRequest('/fly', 'POST');
  if (res && res.success) {
    loadTodayAndWeek();
  }
}

async function loadStats() {
  const data = await apiRequest('/stats');
  if (!data) return;
  document.getElementById('statsContent').innerHTML = `
    æœ¬å‘¨ï¼š${data.week} æ¬¡<br>
    æœ¬æœˆï¼š${data.month} æ¬¡<br>
    ä»Šå¹´ï¼š${data.year} æ¬¡<br>
    æ€»è®¡ï¼š${data.total} æ¬¡
  `;
}

document.getElementById('flyBtn').addEventListener('click', fly);

document.getElementById('clearBtn').addEventListener('click', async () => {
  if (!confirm('çœŸçš„è¦æ¸…ç©ºæ‰€æœ‰èµ·é£è®°å½•å—ï¼Ÿä¸å¯æ¢å¤ï¼')) return;
  const res = await apiRequest('/clear', 'POST');
  if (res && res.success) {
    location.reload();
  }
});

// é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
loadTodayAndWeek();
</script>
</body>
</html>